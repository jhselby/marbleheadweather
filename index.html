<!DOCTYPE html>
<html>
<head>
    <title>Wyman Cove Hyperlocal</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        body { font-family: sans-serif; max-width: 800px; margin: auto; padding: 20px; background: #f4f4f9; }
        .card { background: white; padding: 20px; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); margin-bottom: 20px; }
        .sun-times { display: flex; justify-content: space-around; font-weight: bold; color: #555; }
        .timestamp { text-align: right; font-size: 0.8em; color: #888; margin-top: -10px; margin-bottom: 20px; }
    </style>
</head>
<body>
    <h1>Wyman Cove Monitor</h1>
    <div id="last-updated" class="timestamp">Checking status...</div>
    
    <div class="card sun-times">
        <span id="sunrise">Sunrise: --:--</span>
        <span id="sunset">Sunset: --:--</span>
    </div>

    <div class="card">
        <h3>Local Reference (Beverly Airport)</h3>
        <p id="current-obs">Loading regional data...</p>
    </div>

    <div class="card"><canvas id="tempChart"></canvas></div>

    <script>
        fetch('weather_data.json?t=' + new Date().getTime()).then(r => r.json()).then(data => {
            // Update Timestamp
            const now = new Date();
            document.getElementById('last-updated').innerText = "Data refreshed: " + now.toLocaleTimeString();

            // Sun Times Logic
            const sun = data.forecast.daily;
            const formatTime = (iso) => new Date(iso).toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'});
            document.getElementById('sunrise').innerText = "Sunrise: " + formatTime(sun.sunrise[0]);
            document.getElementById('sunset').innerText = "Sunset: " + formatTime(sun.sunset[0]);

            // Actuals Logic
            const actual = data.current_actual;
            document.getElementById('current-obs').innerHTML = `Temp: ${actual.temp.toFixed(1)}°F | Wind: ${actual.wind.toFixed(1)} mph`;

            // Chart Logic
            new Chart(document.getElementById('tempChart'), {
                type: 'line',
                data: {
                    labels: data.forecast.hourly.time.map(t => new Date(t).getHours() + ":00"),
                    datasets: [{
                        label: 'Wyman Cove Forecast (°F)',
                        data: data.forecast.hourly.temperature_2m,
                        borderColor: '#2196F3',
                        tension: 0.3,
                        fill: false
                    }]
                }
            });
        });
    </script>
</body>
</html>
